<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <h1>{{ page.title }}</h1>

  {% if page.url != "/" and page.url != "/index.html" %}
    <details class="nav-collapsible">
      <summary>Меню</summary>
      {% include nav.html %}
    </details>
  {% else %}
    {% include nav.html %}
  {% endif %}

  <main>
    {{ content }}
  </main>

  <p><a href="/index.html">⬅ Обратно на домашнюю страничку</a></p>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const main = document.querySelector('main');
      if (!main) return;

      const headings = Array.from(main.querySelectorAll('h2, h3')).filter(h => h.textContent.trim().length);
      if (headings.length < 2) return;

      const toc = document.createElement('nav');
      toc.className = 'page-toc';
      toc.setAttribute('aria-label', 'Краткое содержание');

      const title = document.createElement('p');
      title.className = 'page-toc__title';
      title.textContent = 'Краткое содержание';
      toc.appendChild(title);

      const list = document.createElement('ul');

      headings.forEach(heading => {
        if (!heading.id) {
          heading.id = heading.textContent
            .toLowerCase()
            .trim()
            .replace(/[^a-zа-я0-9\s-]/g, '')
            .replace(/\s+/g, '-');
        }

        const item = document.createElement('li');
        item.classList.add('page-toc__item', `page-toc__item--${heading.tagName.toLowerCase()}`);

        const link = document.createElement('a');
        link.href = `#${heading.id}`;
        link.textContent = heading.textContent.trim();

        item.appendChild(link);
        list.appendChild(item);
      });

      toc.appendChild(list);
      main.insertBefore(toc, main.firstChild);
    });
  </script>

</body>
</html>
